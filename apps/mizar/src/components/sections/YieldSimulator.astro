---
interface Props {
  title: string;
}

const { title } = Astro.props;
---

<div class="pt-36" id="yield-simulator">
  <p
    class="text-[2.13rem] leading-9 font-semibold mb-3 text-center mx-auto"
    set:html={title}
  />
  <p class="text-lg text-neutral-600 mb-8 text-center">
    Descubrí cuánto podes ganar con nuestro rendimiento promedio del 14.11% anual:
  </p>
  <div class="mt-16">
    <div class="bg-neutral-50 rounded-xl p-8 max-w-2xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Monto (Q)
          </label>
          <input
            type="number"
            id="amount-input"
            placeholder="100,000"
            value="100000"
            class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Plazo (meses)
          </label>
          <select
            id="duration-select"
            class="w-full px-4 py-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="6">6 meses</option>
            <option value="9">9 meses</option>
            <option value="12" selected>12 meses</option>
            <option value="18">18 meses</option>
            <option value="24">24 meses</option>
            <option value="36">36 meses</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Tasa proyectada
          </label>
          <div class="px-4 py-3 bg-white border border-neutral-300 rounded-lg">
            <span
              id="projected-rate"
              class="text-lg font-semibold text-green-600">14.11%</span
            >
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium text-neutral-700 mb-2">
            Ganancia estimada
          </label>
          <div
            class="px-4 py-3 bg-green-100 border border-green-300 rounded-lg"
          >
            <span id="estimated-profit" class="text-lg font-bold text-green-700"
              >Q0</span
            >
          </div>
        </div>
      </div>

      <div class="text-center">
        <div class="text-sm text-neutral-600 mb-4">
          *Cálculo estimado basado en rendimiento histórico promedio
        </div>
        <button
          class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
        >
          Empezar a invertir ahora
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function updateCalculation() {
    const amount = parseFloat(
      (document.getElementById("amount-input") as HTMLInputElement)?.value ||
        "0"
    );
    const duration = parseInt(
      (document.getElementById("duration-select") as HTMLSelectElement)
        ?.value || "12"
    );

    // Rate calculation based on duration using PDF data
    let rate = 0.1411; // 14.11% base rate as per PDF
    if (duration >= 24) rate = 0.16; // Higher rate for longer terms
    if (duration >= 36) rate = 0.18; // Maximum rate for longest terms

    const projectedRateElement = document.getElementById("projected-rate");
    const estimatedProfitElement = document.getElementById("estimated-profit");

    if (projectedRateElement && estimatedProfitElement) {
      projectedRateElement.textContent = `${(rate * 100).toFixed(2)}%`;

      const monthlyRate = rate / 12;
      const totalProfit = amount * monthlyRate * duration;

      estimatedProfitElement.textContent = `Q${totalProfit.toLocaleString("es-GT", { maximumFractionDigits: 0 })}`;
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    const amountInput = document.getElementById("amount-input");
    const durationSelect = document.getElementById("duration-select");

    amountInput?.addEventListener("input", updateCalculation);
    durationSelect?.addEventListener("change", updateCalculation);

    // Initial calculation
    updateCalculation();
  });
</script>
